<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">


  <title>DevOps 工具链管理器 DevStream 还真是神器-阳明的博客|Kubernetes|Istio|Prometheus|Python|Golang|云原生</title>
  <meta property="og:title" content="DevOps 工具链管理器 DevStream 还真是神器" />
  <meta name="twitter:title" content="DevOps 工具链管理器 DevStream 还真是神器" />

  <meta name="description" content="DevStream 是一个开源的 DevOps 工具链管理器，因开发者而生，由开发者开发，为开发者服务。
想象你正在开始一个新的项目或组建一个新的团队。在写第一行代码之前，你需要一个能够高效运转 SDLC(软件开发生命周期)和承载开发至部署全过程的工具。
通常情况下，你需要以下几个部分来高效地工作。

项目管理软件或  issue  追溯工具（JIRA 等）
源代码管理（GitHub、Bitbucket 等）
持续集成（Jenkins、CircleCI、Travis CI 等）
持续交付/部署（Flux CD/Flux2、Argo CD 等)
密钥和证书的单一事实来源(A single source of truth)（密钥管理器，如 HashiCorp 的 Vault）
集成化的日志和监控工具（例如，ELK、Prometheus/Grafana）
&hellip;&hellip;

实际的情况可能远不止这些，要找到合适的组件本身就不容易了，再将这些工具整合起来就更难了，需要花费大量的时间和精力。而 DevStream 就是为简化整合 DevOps 组件而构建的工具，有点类似于 yum、apt 这些软件包管理工具，DevStream 就是 DevOps 工具领域的软件包管理器。">
  <meta property="og:description" content="DevStream 是一个开源的 DevOps 工具链管理器，因开发者而生，由开发者开发，为开发者服务。
想象你正在开始一个新的项目或组建一个新的团队。在写第一行代码之前，你需要一个能够高效运转 SDLC(软件开发生命周期)和承载开发至部署全过程的工具。
通常情况下，你需要以下几个部分来高效地工作。

项目管理软件或  issue  追溯工具（JIRA 等）
源代码管理（GitHub、Bitbucket 等）
持续集成（Jenkins、CircleCI、Travis CI 等）
持续交付/部署（Flux CD/Flux2、Argo CD 等)
密钥和证书的单一事实来源(A single source of truth)（密钥管理器，如 HashiCorp 的 Vault）
集成化的日志和监控工具（例如，ELK、Prometheus/Grafana）
&hellip;&hellip;

实际的情况可能远不止这些，要找到合适的组件本身就不容易了，再将这些工具整合起来就更难了，需要花费大量的时间和精力。而 DevStream 就是为简化整合 DevOps 组件而构建的工具，有点类似于 yum、apt 这些软件包管理工具，DevStream 就是 DevOps 工具领域的软件包管理器。">
  <meta name="twitter:description" content="DevStream 是一个开源的 DevOps 工具链管理器，因开发者而生，由开发者开发，为开发者服务。
想象你正在开始一个新的项目或组建一个新的团队。在写第一行代码之前，你需要一个能够高效运转 SDLC(软件开发生命周期)和承载开发至部署全过程的工具。
通常情况下，你需要以下几个部分来高效地工作。

项目管理软件或  issue  追溯工具（JIRA 等）
源代码管 …">
  <meta name="author" content=""/>
  <link href="https://picdn.youdianzhishi.com/images/blog-favicon.png" rel="icon" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://picdn.youdianzhishi.com/images/blog-favicon.png"/>
  <meta property="og:image" content="https://picdn.youdianzhishi.com/images/blog-favicon.png" />
  <meta name="twitter:image" content="https://picdn.youdianzhishi.com/images/blog-favicon.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://www.qikqiak.com/post/devops-tools-chain-devstream/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="阳明的博客" />

  <link rel="canonical" href="https://www.qikqiak.com/post/devops-tools-chain-devstream/" />
  <link rel="alternate" href="https://www.qikqiak.com/index.xml" type="application/rss+xml" title="阳明的博客">

  
  
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700%7COpen+Sans:400,700" rel="stylesheet">
  

  <link rel="stylesheet" href='https://www.qikqiak.com/css/bundle.min.a6b62363fe57848ad01efa2a5d1bbb1047c2ffb71b53d8aeb42bc5ed5c77ea7c.css' integrity='sha256-prYjY/5XhIrQHvoqXRu7EEfC/7cbU9iutCvF7Vx36nw='>

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  
  
    
    <!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <![endif]-->
<meta name="google-site-verification" content="oKxX4fOvB2yYmU02txZFChM93XQbESU4JaG3tNH9Hm8" />
<meta name="baidu-site-verification" content="F5ojAyqaKU" />
<meta name="keywords" content="kubernetes, devops, devstream, 工具链">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d611849735f187dd788dc054908f7d7a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-69668147-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://www.qikqiak.com/" title="阳明的博客">
        <img src="https://picdn.youdianzhishi.com/images/blog-logo-new.png" style="margin-top: -5px;height: 32px;" alt="阳明的博客">
      </a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="首页" href="https://www.qikqiak.com/">首页</a>
            </li>
          
        
          
            <li>
              <a title="课程" href="https://youdianzhishi.com/?utm_source=blog&amp;utm_campaign=referral&amp;utm_medium=topmenu">课程</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">文章分类</a>
              <div class="navlinks-children">
                
                  <a href="https://www.qikqiak.com/archives">Archive</a>
                
                  <a href="https://www.qikqiak.com/tags">tags</a>
                
                  <a href="https://www.qikqiak.com/tags/kubernetes">kubernetes</a>
                
                  <a href="https://www.qikqiak.com/tags/python">python</a>
                
                  <a href="https://www.qikqiak.com/tags/django">django</a>
                
                  <a href="https://www.qikqiak.com/tags/devops">devops</a>
                
              </div>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">书籍</a>
              <div class="navlinks-children">
                
                  <a href="https://www.qikqiak.com/k8s-book/">k8s进阶手册</a>
                
                  <a href="https://www.qikqiak.com/istio-book/">一起学istio</a>
                
                  <a href="https://www.qikqiak.com/tdd-book/">Python微服务</a>
                
                  <a href="https://md.qikqiak.com/">Markdown微信</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="关于" href="https://www.qikqiak.com/page/about/">关于</a>
            </li>
          
        
          
            <li>
              <a title="RSS" href="https://www.qikqiak.com/index.xml">RSS</a>
            </li>
          
        

        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
          

      </ul>
    </div>

  </div>
</nav>


  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">搜索</h4>
        </div>
        <div class="modal-body">
            
<div class="aa-input-container" id="aa-input-container">
    <input type="search" id="aa-search-input" class="aa-input-search" placeholder="Search for titles or URIs..." name="search" autocomplete="off" />
    <svg class="aa-input-icon" viewBox="654 -372 1664 1664">
        <path d="M1806,332c0-123.3-43.8-228.8-131.5-316.5C1586.8-72.2,1481.3-116,1358-116s-228.8,43.8-316.5,131.5  C953.8,103.2,910,208.7,910,332s43.8,228.8,131.5,316.5C1129.2,736.2,1234.7,780,1358,780s228.8-43.8,316.5-131.5  C1762.2,560.8,1806,455.3,1806,332z M2318,1164c0,34.7-12.7,64.7-38,90s-55.3,38-90,38c-36,0-66-12.7-90-38l-343-342  c-119.3,82.7-252.3,124-399,124c-95.3,0-186.5-18.5-273.5-55.5s-162-87-225-150s-113-138-150-225S654,427.3,654,332  s18.5-186.5,55.5-273.5s87-162,150-225s138-113,225-150S1262.7-372,1358-372s186.5,18.5,273.5,55.5s162,87,225,150s113,138,150,225  S2062,236.7,2062,332c0,146.7-41.3,279.7-124,399l343,343C2305.7,1098.7,2318,1128.7,2318,1164z" />
    </svg>
</div>
<script src="https://www.qikqiak.com/js/algoliasearch.min.js"></script>
<script src="https://www.qikqiak.com/js/autocomplete.min.js"></script>

<script>
var client = algoliasearch("1JDRAS0AZR", "8804ac109158bb3bb60d74ce98fa332f");
var index = client.initIndex('prod_blog');

autocomplete('#aa-search-input',
{ hint: false}, {
    source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
    
    displayKey: 'name',
    
    templates: {
        
        suggestion: function(suggestion) {
            return '<span>' + '<a href="https://www.qikqiak.com/post/' + suggestion.slug + '">' +
            suggestion._highlightResult.title.value + '</a></span>';
        }
    }
});
</script>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
        </div>
      </div>
    </div>
  </div>

    
  
  
  




  
    <div id="header-big-imgs" data-num-img=1 data-img-src-1="https://picdn.youdianzhishi.com/images/1658384199220.jpg" data-img-desc-1="https://unsplash.com/photos/6gZDIWrsfTs"></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>DevOps 工具链管理器 DevStream 还真是神器</h1>
                  
                  
                    <span class="post-meta">
  发表于 July 2, 2022  
</span>

                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>DevOps 工具链管理器 DevStream 还真是神器</h1>
                
                
                  <span class="post-meta">
  发表于 July 2, 2022  
</span>

                
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
  </header>


    



<div class="container" role="main">
  <div class="row">

    
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div>
            
            
            <h5 id="tags" style="margin-top: 30px;">标签:
              
                  <a href="https://www.qikqiak.com/tags/kubernetes/">kubernetes</a> &nbsp;
              
                  <a href="https://www.qikqiak.com/tags/devops/">devops</a> &nbsp;
              
            </h5>
            
        </div>
  
        <article role="main" class="blog-post" itemprop="articleBody" id="content">
          
            
<aside class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#核心概念">核心概念</a>
      <ul>
        <li><a href="#config配置">Config（配置）</a></li>
        <li><a href="#tool工具">Tool（工具）</a></li>
        <li><a href="#state状态">State（状态）</a></li>
        <li><a href="#resource资源">Resource（资源）</a></li>
      </ul>
    </li>
    <li><a href="#安装">安装</a></li>
    <li><a href="#使用">使用</a>
      <ul>
        <li><a href="#基本命令">基本命令</a></li>
        <li><a href="#实践">实践</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>

          
  
          
          
          
  
          
          
          
  
          
          
          

          <p><a href="https://github.com/devstream-io/devstream">DevStream</a> 是一个开源的 DevOps 工具链管理器，因开发者而生，由开发者开发，为开发者服务。</p>
<p>想象你正在开始一个新的项目或组建一个新的团队。在写第一行代码之前，你需要一个能够高效运转 SDLC(软件开发生命周期)和承载开发至部署全过程的工具。</p>
<p>通常情况下，你需要以下几个部分来高效地工作。</p>
<ul>
<li>项目管理软件或  <code>issue</code>  追溯工具（JIRA 等）</li>
<li>源代码管理（GitHub、Bitbucket 等）</li>
<li>持续集成（Jenkins、CircleCI、Travis CI 等）</li>
<li>持续交付/部署（Flux CD/Flux2、Argo CD 等)</li>
<li>密钥和证书的单一事实来源(A single source of truth)（密钥管理器，如 HashiCorp 的 Vault）</li>
<li>集成化的日志和监控工具（例如，ELK、Prometheus/Grafana）</li>
<li>&hellip;&hellip;</li>
</ul>
<p>实际的情况可能远不止这些，要找到合适的组件本身就不容易了，再将这些工具整合起来就更难了，需要花费大量的时间和精力。而 <code>DevStream</code> 就是为简化整合 DevOps 组件而构建的工具，有点类似于 <code>yum</code>、<code>apt</code> 这些软件包管理工具，<code>DevStream</code> 就是 DevOps 工具领域的软件包管理器。</p>
<h2 id="核心概念">核心概念</h2>
<p>DevOps 中通用的一些概念，比如 Git、Docker、Kubernetes、Continuous Integratoin、Continuous Delivery 和 GitOps，这些也是 DevStream 的核心概念。</p>
<p><code>DevStream</code> 中涉及到几个自己的概念：Config（配置）、Tool（工具）、State（状态）、Resource（资源），这几个概念构成了 <code>DevStream</code> 的整个工作流，下面我们来具体了解下这几个概念。</p>
<h3 id="config配置">Config（配置）</h3>
<p><code>DevStream</code> 通过配置文件来定义你的 DevOps 工具链，一共包括 3 个配置文件：</p>
<ul>
<li>main config file（主配置文件）</li>
<li>variable config file（变量配置文件）</li>
<li>tool config file（工具配置文件）</li>
</ul>
<p><strong>主配置文件</strong></p>
<p>默认情况下，dtm（DevStream 的命令行工具）会尝试使用 <code>./config.yaml</code> 作为主配置文件。主配置文件主要包含 3 个部分：</p>
<ul>
<li><code>varFile</code>：var 文件的文件路径</li>
<li><code>toolFile</code>：工具文件的文件路径</li>
<li><code>state</code>：与状态相关的设置</li>
</ul>
<p>如下所示的 <code>config.yaml</code> 文件就是一个主配置文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># config.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">varFile</span>: variables.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">toolFile</span>: tools.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">state</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">backend</span>: local
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">stateFile</span>: devstream.state
</span></span></code></pre></div><p><strong>变量配置文件</strong></p>
<p>变量配置文件是一个包含键值对的 YAML 文件，可以在工具配置文件中使用。</p>
<p>如下所示的 <code>variables.yaml</code> 文件就是一个变量配置文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># variables.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">githubUsername</span>: cnych
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">repoName</span>: dtm-test-go
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">defaultBranch</span>: main
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">dockerhubUsername</span>: cnych
</span></span></code></pre></div><p><strong>工具配置文件</strong></p>
<p>工具配置文件包含工具列表。工具文件包含以下内容：</p>
<ul>
<li>目前只有一个配置块，即 <code>tools</code></li>
<li><code>tools</code> 是一个字典列表</li>
<li>每个字典都定义了一个由 <code>DevStream</code> 插件管理的 DevOps <strong>工具</strong></li>
<li>每个字典（工具）都有以下必填字段：
<ul>
<li><code>name</code>：工具/插件的名称，字符串，不带下划线</li>
<li><code>instanceID</code>：该工具实例的 id</li>
<li>一个配置文件中可以有重复的名称，也可以在一个配置文件中有重复的 <code>instanceID</code>，但是 <code>name + instanceID</code> 的组合在一个配置文件中必须是唯一的</li>
</ul>
</li>
<li>每个工具都有一个可选字段，即 <code>options</code>，它是一个包含该特定插件参数的字典</li>
<li>每个工具都有一个可选字段，即 <code>dependsOn</code>，用来定义相关依赖项</li>
</ul>
<p>如下所示的 <code>tools.yaml</code> 文件就定义了一个工具配置文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># tools.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">tools</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: github-repo-scaffolding-golang
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">owner</span>: [[ githubUsername ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">org</span>: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">repo</span>: [[ repoName ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">branch</span>: [[ defaultBranch ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">image_repo</span>: [[ dockerhubUsername ]]/[[ repoName ]]
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: jira-github-integ
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">dependsOn</span>: [ <span style="color:#f1fa8c">&#34;github-repo-scaffolding-golang.default&#34;</span> ]
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">owner</span>: [[ githubUsername ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">repo</span>: [[ repoName ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">jiraBaseUrl</span>: https://xxx.atlassian.net
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">jiraUserEmail</span>: foo@bar.com
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">jiraProjectKey</span>: zzz
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">branch</span>: main
</span></span></code></pre></div><p>配置文件中的变量可以看到我们是通过 <code>[[ varNameHere ]]</code> 来定义的。<code>DevStream</code> 将使用提供的 var 文件来渲染上面的配置。</p>
<p><strong>state</strong></p>
<p>主配置文件中还包括一个 <code>state</code> 属性，<code>state</code> 部分指定存储 <code>DevStream</code> 状态的位置。到目前的 v0.6.0 版本开始，<code>DevStream</code> 同时支持 <code>local</code> 和 <code>s3</code> 后端存储来保存 <code>DevStream</code> 的状态。</p>
<p>如果使用的是 <code>local</code> 模式，那么 <code>state.options.stateFile</code> 是必须配置的属性。如果使用 <code>s3</code> 这种后端存储模式，则对应的配置如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">varFile</span>: variables.yaml
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">toolFile</span>: tools.yaml
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">state</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">backend</span>: s3
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">bucket</span>: devstream-remote-state
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">region</span>: ap-southeast-1
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">key</span>: devstream.state
</span></span></code></pre></div><p>其中 <code>state.options</code> 属性下的 <code>bucket</code>、<code>region</code> 和 <code>key</code> 都是 <code>s3</code> 后端的必填字段。在真正使用的时候我们需要通过环境变量来配置 AWS 的相关密钥信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">AWS_ACCESS_KEY_ID</span><span style="color:#ff79c6">=</span>ID_HERE
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">AWS_SECRET_ACCESS_KEY</span><span style="color:#ff79c6">=</span>SECRET_HERE
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">AWS_DEFAULT_REGION</span><span style="color:#ff79c6">=</span>REGION_HERE
</span></span></code></pre></div><blockquote>
<p>注意：同样我们也可以将多个 YAML 文件放在同一个文件中，并用三个破折号 (&mdash;) 分隔不同的文件。</p>
</blockquote>
<h3 id="tool工具">Tool（工具）</h3>
<ul>
<li>每个工具对应着一个插件，可以用来安装、配置或集成一些 DevOps 工具。</li>
<li>每个工具都有其名称、InstanceID 和选项。</li>
<li>每个工具都可以有其依赖项，这些依赖项由 <code>dependsOn</code> 字段指定。</li>
</ul>
<p><code>dependsOn</code> 是一个字符串数组，每个元素都是一个依赖。每个依赖项都以 <code>TOOL_NAME.INSTANCE_ID</code> 的格式命名。</p>
<h3 id="state状态">State（状态）</h3>
<p>State 记录了您的 DevOps 工具链的当前状态，它包含每个工具的配置和当前状态。</p>
<ul>
<li>状态是一个 Map</li>
<li>Map 中的每个状态都是一个包含名称、插件、选项和资源的结构</li>
</ul>
<h3 id="resource资源">Resource（资源）</h3>
<p>我们将创建的插件称为资源，插件的 <code>Read()</code> 接口将返回对该资源的描述，该描述又存储为状态的一部分。</p>
<p><code>DevStream</code> 的整个工作流如下图所示：
<img src="https://picdn.youdianzhishi.com/images/1656729342474.jpg" alt=""></p>
<ul>
<li>首先获取工具状态</li>
<li>如果状态中没找到工具，则调用 <code>Create()</code> 接口创建</li>
<li>如果状态中找到了工具，则从状态中进行配置对比，如果有变化，则调用 <code>Update()</code> 接口进行更新</li>
<li>如果没有变化则调用 <code>Read()</code> 接口从资源中获取描述信息</li>
<li>如果没有对应的资源，则调用 <code>Create()</code> 接口创建资源</li>
<li>如果有对应的资源，则从状态中进行资源对比，如果有变化，同样调用 <code>Update()</code> 接口更新</li>
<li>如果没任何变化则忽略</li>
</ul>
<h2 id="安装">安装</h2>
<p><code>DevStream</code> 的命令行工具叫 <code>dtm</code>，我们只需要下载该文件即可，前往 Release 页面 <a href="https://github.com/devstream-io/devstream/releases">https://github.com/devstream-io/devstream/releases</a> 打开最新的版本，下载对应平台的安装包（目前只支持 Linux 和 MacOS 系统）。</p>
<p>比如我这里是 Mac m1 平台，则下载 <a href="https://devstream.gateway.scarf.sh/releases/v0.7.0/dtm-darwin-arm64">https://devstream.gateway.scarf.sh/releases/v0.7.0/dtm-darwin-arm64</a> 这个安装包，</p>
<p>标记 dtm 为可执行文件，然后将其移动到 PATH 路径下面去：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mv dtm-darwin-arm64 dtm
</span></span><span style="display:flex;"><span>chmod +x dtm
</span></span><span style="display:flex;"><span>sudo mv dtm /usr/local/bin
</span></span></code></pre></div><p>现在我们可以通过执行 dtm 命令来验证是否安装成功。</p>
<p><img src="https://picdn.youdianzhishi.com/images/1656732896001.png" alt=""></p>
<h2 id="使用">使用</h2>
<h3 id="基本命令">基本命令</h3>
<p>安装完成后我们就可以使用 <code>dtm</code> 工具了，直接执行 <code>dtm</code> 命令会显示目前所有的可用命令。</p>
<p>比如使用 <code>dtm list plugins</code> 命令可以查看目前 <code>DevStream</code> 支持的插件列表。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm list plugins
</span></span><span style="display:flex;"><span>argocd
</span></span><span style="display:flex;"><span>argocdapp
</span></span><span style="display:flex;"><span>devlake
</span></span><span style="display:flex;"><span>github-repo-scaffolding-golang
</span></span><span style="display:flex;"><span>githubactions-golang
</span></span><span style="display:flex;"><span>githubactions-nodejs
</span></span><span style="display:flex;"><span>githubactions-python
</span></span><span style="display:flex;"><span>gitlab-ce-docker
</span></span><span style="display:flex;"><span>gitlab-repo-scaffolding-golang
</span></span><span style="display:flex;"><span>gitlabci-generic
</span></span><span style="display:flex;"><span>gitlabci-golang
</span></span><span style="display:flex;"><span>hashicorp-vault
</span></span><span style="display:flex;"><span>helm-generic
</span></span><span style="display:flex;"><span>jenkins
</span></span><span style="display:flex;"><span>jira-github-integ
</span></span><span style="display:flex;"><span>kube-prometheus
</span></span><span style="display:flex;"><span>openldap
</span></span><span style="display:flex;"><span>tekton
</span></span><span style="display:flex;"><span>trello
</span></span><span style="display:flex;"><span>trello-github-integ
</span></span></code></pre></div><p>使用 <code>dtm show config</code> 命令可以显示默认的配置信息，其实就是 3 个主要配置文件的配置样例，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm show config
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># defaultconfig.yaml sample:</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># var file path, you can set it to absolute path or relative path.</span>
</span></span><span style="display:flex;"><span>varFile: variables.yaml <span style="color:#6272a4"># here is a relative path. (defaults is ./variables.yaml)</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># tool file path, you can set it to absolute path or relative path.</span>
</span></span><span style="display:flex;"><span>toolFile: tools.yaml <span style="color:#6272a4"># here is a relative path.</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># state config</span>
</span></span><span style="display:flex;"><span>state:
</span></span><span style="display:flex;"><span>  backend: <span style="color:#8be9fd;font-style:italic">local</span> <span style="color:#6272a4"># backend can be local or s3</span>
</span></span><span style="display:flex;"><span>  options:
</span></span><span style="display:flex;"><span>    stateFile: devstream.state
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># tools.yaml sample:</span>
</span></span><span style="display:flex;"><span>tools:
</span></span><span style="display:flex;"><span>  - name: github-repo-scaffolding-golang
</span></span><span style="display:flex;"><span>    instanceID: default
</span></span><span style="display:flex;"><span>    options:
</span></span><span style="display:flex;"><span>      owner: <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">[</span> githubUsername <span style="color:#ff79c6">]</span> <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>      org: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>      repo: <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">[</span> repoName <span style="color:#ff79c6">]</span> <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># variables.yaml sample:</span>
</span></span><span style="display:flex;"><span>githubUsername: daniel-hutao
</span></span><span style="display:flex;"><span>repo: go-webapp-demo
</span></span></code></pre></div><p>此外我们还可以在 <code>show config</code> 命令后面添加一个 <code>--plugin</code> 参数，来显示指定插件的配置信息，比如我们查看 argocd 的配置，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm show config --plugin argocd
</span></span><span style="display:flex;"><span>tools:
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4"># name of the tool</span>
</span></span><span style="display:flex;"><span>  - name: argocd
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># id of the tool instance</span>
</span></span><span style="display:flex;"><span>    instanceID: default
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># format: name.instanceID; If specified, dtm will make sure the dependency is applied first before handling this tool.</span>
</span></span><span style="display:flex;"><span>    dependsOn: <span style="color:#ff79c6">[</span> <span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># options for the plugin</span>
</span></span><span style="display:flex;"><span>    options:
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4"># need to create the namespace or not, default: false</span>
</span></span><span style="display:flex;"><span>      create_namespace: <span style="color:#8be9fd;font-style:italic">true</span>
</span></span><span style="display:flex;"><span>      repo:
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># name of the Helm repo</span>
</span></span><span style="display:flex;"><span>        name: argo
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># url of the Helm repo</span>
</span></span><span style="display:flex;"><span>        url: https://argoproj.github.io/argo-helm
</span></span><span style="display:flex;"><span>      <span style="color:#6272a4"># Helm chart information</span>
</span></span><span style="display:flex;"><span>      chart:
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># name of the chart</span>
</span></span><span style="display:flex;"><span>        chart_name: argo/argo-cd
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># release name of the chart</span>
</span></span><span style="display:flex;"><span>        release_name: argocd
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># k8s namespace where ArgoCD will be installed</span>
</span></span><span style="display:flex;"><span>        namespace: argocd
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># whether to wait for the release to be deployed or not</span>
</span></span><span style="display:flex;"><span>        wait: <span style="color:#8be9fd;font-style:italic">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># the time to wait for any individual Kubernetes operation (like Jobs for hooks). This defaults to 5m0s</span>
</span></span><span style="display:flex;"><span>        timeout: 5m
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># whether to perform a CRD upgrade during installation</span>
</span></span><span style="display:flex;"><span>        upgradeCRDs: <span style="color:#8be9fd;font-style:italic">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># custom configuration (Optional). You can refer to [ArgoCD values.yaml](https://github.com/argoproj/argo-helm/blob/master/charts/argo-cd/values.yaml)</span>
</span></span><span style="display:flex;"><span>        values_yaml: |
</span></span><span style="display:flex;"><span>          controller:
</span></span><span style="display:flex;"><span>            service:
</span></span><span style="display:flex;"><span>              port: <span style="color:#bd93f9">8080</span>
</span></span></code></pre></div><p>如果我们想要开发自己的插件，可以使用 <code>dtm develop</code> 命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm develop
</span></span><span style="display:flex;"><span>Develop is used <span style="color:#ff79c6">for</span> develop a new plugin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  dtm develop <span style="color:#ff79c6">[</span>command<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Available Commands:
</span></span><span style="display:flex;"><span>  create-plugin   Create a new plugin
</span></span><span style="display:flex;"><span>  validate-plugin Validate a plugin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Flags:
</span></span><span style="display:flex;"><span>  -h, --help   <span style="color:#8be9fd;font-style:italic">help</span> <span style="color:#ff79c6">for</span> develop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Global Flags:
</span></span><span style="display:flex;"><span>      --debug   debug level log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Use <span style="color:#f1fa8c">&#34;dtm develop [command] --help&#34;</span> <span style="color:#ff79c6">for</span> more information about a command.
</span></span></code></pre></div><p>其中包含 <code>create-plugin</code> 和 <code>validate-plugin</code> 两个子命令，一个用于创建一个新的插件，一个用于校验插件使用，比如创建一个名为 <code>plugin-demo</code> 的插件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm develop create-plugin
</span></span><span style="display:flex;"><span>2022-07-02 12:10:29 ✖ <span style="color:#ff79c6">[</span>FATAL<span style="color:#ff79c6">]</span>  the name must be not <span style="color:#f1fa8c">&#34;&#34;</span>, you can specify it by --name flag
</span></span><span style="display:flex;"><span>$ dtm develop create-plugin --name plugin-demo
</span></span><span style="display:flex;"><span>2022-07-02 12:10:45 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Render template files finished.
</span></span><span style="display:flex;"><span>2022-07-02 12:10:45 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Persist all files finished.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The DevStream PMC <span style="color:#ff79c6">(</span>project management committee<span style="color:#ff79c6">)</span> sincerely thank you <span style="color:#ff79c6">for</span> your devotion and enthusiasm in creating new plugins!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To make the process easy as a breeze, DevStream<span style="color:#ff79c6">(</span>dtm<span style="color:#ff79c6">)</span> has generated some templated <span style="color:#8be9fd;font-style:italic">source</span> code files <span style="color:#ff79c6">for</span> you to flatten the learning curve and reduce manual copy-paste.
</span></span><span style="display:flex;"><span>In the generated templates, dtm has left some special marks in the format of <span style="color:#f1fa8c">&#34;TODO(dtm)&#34;</span>.
</span></span><span style="display:flex;"><span>Please look <span style="color:#ff79c6">for</span> these TODOs by global search. Once you find them, you will know what to <span style="color:#ff79c6">do</span> with them. Also, please remember to check our documentation on creating a new plugin:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>**README_when_create_plugin.md**
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Source code files created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Happy hacking, buddy!
</span></span><span style="display:flex;"><span>Please give us feedback through GitHub issues <span style="color:#ff79c6">if</span> you encounter any difficulties. We guarantee that you will receive unrivaled <span style="color:#8be9fd;font-style:italic">help</span> from our passionate community!
</span></span></code></pre></div><p>上面的命令会创建一个插件开发的脚手架，结构如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ tree .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── README_when_create_plugin.md
</span></span><span style="display:flex;"><span>├── cmd
</span></span><span style="display:flex;"><span>│   └── plugin
</span></span><span style="display:flex;"><span>│       └── plugin-demo
</span></span><span style="display:flex;"><span>│           └── main.go
</span></span><span style="display:flex;"><span>├── docs
</span></span><span style="display:flex;"><span>│   └── plugins
</span></span><span style="display:flex;"><span>│       └── plugin-demo.md
</span></span><span style="display:flex;"><span>└── internal
</span></span><span style="display:flex;"><span>    └── pkg
</span></span><span style="display:flex;"><span>        ├── plugin
</span></span><span style="display:flex;"><span>        │   └── plugindemo
</span></span><span style="display:flex;"><span>        │       ├── create.go
</span></span><span style="display:flex;"><span>        │       ├── delete.go
</span></span><span style="display:flex;"><span>        │       ├── options.go
</span></span><span style="display:flex;"><span>        │       ├── plugindemo.go
</span></span><span style="display:flex;"><span>        │       ├── read.go
</span></span><span style="display:flex;"><span>        │       ├── update.go
</span></span><span style="display:flex;"><span>        │       └── validate.go
</span></span><span style="display:flex;"><span>        └── show
</span></span><span style="display:flex;"><span>            └── config
</span></span><span style="display:flex;"><span>                └── plugins
</span></span><span style="display:flex;"><span>                    └── plugin-demo.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">12</span> directories, <span style="color:#bd93f9">11</span> files
</span></span></code></pre></div><p>然后可以根据我们自己的实际需求去开发对应的插件即可，开发完成后可以校验插件的有效性。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm develop validate-plugin --name plugin-demo
</span></span><span style="display:flex;"><span>2022-07-02 12:13:05 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Plugin &lt;plugin-demo&gt; passed validation.
</span></span></code></pre></div><h3 id="实践">实践</h3>
<p>接下来我们使用 <code>DevStream</code> 来实践下如何快速创建我们的 DevOps 工具链。</p>
<p>首先创建一个名为 <code>devstream-demo</code> 的目录：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir devstream-demo <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#8be9fd;font-style:italic">cd</span> devstream-demo
</span></span></code></pre></div><p>然后在该目录下创建一个名为 <code>config.yaml</code> 的主配置文件，文件内容如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># config.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">varFile</span>: variables-gitops.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">toolFile</span>: tools-gitops.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">state</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">backend</span>: local
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">stateFile</span>: devstream.state
</span></span></code></pre></div><p>在该主配置文件中我们指定了 <code>varFile</code> 和 <code>toolFile</code> 两个配置文件，已经使用了本地存储状态信息。</p>
<p>同样在该目录下面创建对应的变量配置文件 <code>variables-gitops.yaml</code>，内容如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># variables-gitops.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">githubUsername</span>: cnych
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">repoName</span>: dtm-test-go
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">defaultBranch</span>: main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">dockerhubUsername</span>: cnych
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">argocdNamespace</span>: argocd
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">argocdDeployTimeout</span>: 5m
</span></span></code></pre></div><p>该配置文件中我们定义了一些后面工具中需要使用到的变量。</p>
<p>接下来创建工具配置文件 <code>tools-gitops.yaml</code>，文件内容如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#6272a4"># tools-gitops.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">tools</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: github-repo-scaffolding-golang
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">owner</span>: [[ githubUsername ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">org</span>: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">repo</span>: [[ repoName ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">branch</span>: [[ defaultBranch ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">image_repo</span>: [[ dockerhubUsername ]]/[[ repoName ]]
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: githubactions-golang
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">dependsOn</span>: [<span style="color:#f1fa8c">&#34;github-repo-scaffolding-golang.default&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">owner</span>: ${{ github-repo-scaffolding-golang.default.outputs.owner }}
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">org</span>: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">repo</span>: ${{ github-repo-scaffolding-golang.default.outputs.repo }}
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">language</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: go
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">version</span>: <span style="color:#f1fa8c">&#34;1.17&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">branch</span>: [[ defaultBranch ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">build</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">enable</span>: <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">command</span>: <span style="color:#f1fa8c">&#34;go build ./...&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">test</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">enable</span>: <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">command</span>: <span style="color:#f1fa8c">&#34;go test ./...&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">coverage</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">enable</span>: <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">profile</span>: <span style="color:#f1fa8c">&#34;-race -covermode=atomic&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">output</span>: <span style="color:#f1fa8c">&#34;coverage.out&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">docker</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">enable</span>: <span style="color:#ff79c6">True</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">registry</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">type</span>: dockerhub
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">username</span>: [[ dockerhubUsername ]]
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">repository</span>: ${{ github-repo-scaffolding-golang.default.outputs.repo }}
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: argocd
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">create_namespace</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">repo</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: argo
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">url</span>: https://argoproj.github.io/argo-helm
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">chart</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">chart_name</span>: argo/argo-cd
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">release_name</span>: argocd
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">namespace</span>: [[ argocdNamespace ]]
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">wait</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">timeout</span>: [[ argocdDeployTimeout ]]
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">upgradeCRDs</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: argocdapp
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">instanceID</span>: default
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">dependsOn</span>: [<span style="color:#f1fa8c">&#34;argocd.default&#34;</span>, <span style="color:#f1fa8c">&#34;github-repo-scaffolding-golang.default&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">options</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">app</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">name</span>: ${{ github-repo-scaffolding-golang.default.outputs.repo }}
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">namespace</span>: [[ argocdNamespace ]]
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">destination</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">server</span>: https://kubernetes.default.svc
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">namespace</span>: default
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">source</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">valuefile</span>: values.yaml
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">path</span>: helm/${{ github-repo-scaffolding-golang.default.outputs.repo }}
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">repoURL</span>: ${{ github-repo-scaffolding-golang.default.outputs.repoURL }}
</span></span></code></pre></div><p>上面的配置文件中我们定义了 4 个工具，每个工具的 <code>name+instanceID</code> 需要唯一。</p>
<p>其中第一个工具为 <a href="https://docs.devstream.io/en/latest/plugins/github-repo-scaffolding-golang/">github-repo-scaffolding-golang</a> ，该插件使用一个 Golang Web 应用程序的脚手架代码去创建一个 GitHub 代码仓库，使用该插件之前需要配置一个名为 <code>GITHUB_TOKEN</code> 的环境变量，可以前往 <a href="https://github.com/settings/tokens">https://github.com/settings/tokens</a> 创建一个 <code>Personal access tokens</code>，记得要有 repo 和 GitHub Actions 相关权限。</p>
<p>第二个工具插件为 <a href="https://docs.devstream.io/en/latest/plugins/githubactions-golang/">githubactions-golang</a> ，这个插件会创建一些 Golang GitHub Actions 的工作流，同样该插件依赖 <code>GITHUB_TOKEN</code> 这个环境变量，如果启用了 Docker 镜像构建/推送，则还需要设置另外两个环境变量：<code>DOCKERHUB_USERNAME</code> 与 <code>DOCKERHUB_TOKEN</code>，Docker 的 Token 信息可以访问页面 <a href="https://hub.docker.com/settings/security?generateToken=true">https://hub.docker.com/settings/security?generateToken=true</a> 去创建获取。</p>
<p><img src="https://picdn.youdianzhishi.com/images/1656738623638.png" alt=""></p>
<p>第三个插件是 <a href="https://docs.devstream.io/en/latest/plugins/argocd/">argocd</a> ，该插件会使用 Helm chart 的方式在现有 Kubernetes 集群中安装 ArgoCD。</p>
<p>第四个插件是 <a href="https://docs.devstream.io/en/latest/plugins/argocdapp/">argocdapp</a> ，此插件会创建一个 ArgoCD Application 的自定义资源。需要注意使用该插件之前必须要保证 ArgoCD 已经安装。</p>
<p>配置定义完之后，我们只需要在根目录下面执行 <code>dtm init</code>，该命令就会下载所有定义的相关插件，如果你使用的是 <code>s3</code> 来存储状态信息，则当再次执行该命令的时候会先从远程下载对应的状态信息。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm init
</span></span><span style="display:flex;"><span>2022-07-02 12:36:03 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Got Backend from config: <span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>2022-07-02 12:36:03 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Using dir &lt;.devstream&gt; to store plugins.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:05 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>github-repo-scaffolding-golang-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> 15.05 MiB / 15.05 MiB <span style="color:#ff79c6">[=================================]</span> 100.00% 3.30 MiB/s 4s
</span></span><span style="display:flex;"><span>2022-07-02 12:36:10 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>github-repo-scaffolding-golang-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:11 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>github-repo-scaffolding-golang-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">33</span> B / <span style="color:#bd93f9">33</span> B <span style="color:#ff79c6">[===============================================]</span> 100.00% <span style="color:#bd93f9">49</span> B/s 0s
</span></span><span style="display:flex;"><span>2022-07-02 12:36:11 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>github-repo-scaffolding-golang-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:11 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: github-repo-scaffolding-golang-darwin-arm64_0.7.0.so doesn<span style="color:#f1fa8c">&#39;t match with .md5 and will be downloaded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:12 ℹ [INFO]  Downloading: [github-repo-scaffolding-golang-darwin-arm64_0.7.0.so] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 15.05 MiB / 15.05 MiB [=================================] 100.00% 4.71 MiB/s 3s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:15 ✔ [SUCCESS]  [github-repo-scaffolding-golang-darwin-arm64_0.7.0.so] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:15 ℹ [INFO]  Downloading: [github-repo-scaffolding-golang-darwin-arm64_0.7.0.md5] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 33 B / 33 B [=========================================] 100.00% 133.44 KiB/s 0s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:15 ✔ [SUCCESS]  [github-repo-scaffolding-golang-darwin-arm64_0.7.0.md5] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:16 ℹ [INFO]  Downloading: [githubactions-golang-darwin-arm64_0.7.0.so] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 17.49 MiB / 17.49 MiB [=================================] 100.00% 4.05 MiB/s 4s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:20 ✔ [SUCCESS]  [githubactions-golang-darwin-arm64_0.7.0.so] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:21 ℹ [INFO]  Downloading: [githubactions-golang-darwin-arm64_0.7.0.md5] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 33 B / 33 B [=========================================] 100.00% 206.08 KiB/s 0s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:21 ✔ [SUCCESS]  [githubactions-golang-darwin-arm64_0.7.0.md5] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:36:21 ℹ [INFO]  Plugin: githubactions-golang-darwin-arm64_0.7.0.so doesn&#39;</span>t match with .md5 and will be downloaded.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:22 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>githubactions-golang-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> 17.49 MiB / 17.49 MiB <span style="color:#ff79c6">[=================================]</span> 100.00% 4.50 MiB/s 3s
</span></span><span style="display:flex;"><span>2022-07-02 12:36:25 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>githubactions-golang-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:26 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>githubactions-golang-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">33</span> B / <span style="color:#bd93f9">33</span> B <span style="color:#ff79c6">[=========================================]</span> 100.00% 104.90 KiB/s 0s
</span></span><span style="display:flex;"><span>2022-07-02 12:36:26 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>githubactions-golang-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:36:27 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>argocd-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> 78.22 MiB / 78.22 MiB <span style="color:#ff79c6">[================================]</span> 100.00% 1.99 MiB/s 39s
</span></span><span style="display:flex;"><span>2022-07-02 12:37:06 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>argocd-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:37:07 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>argocd-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">33</span> B / <span style="color:#bd93f9">33</span> B <span style="color:#ff79c6">[=========================================]</span> 100.00% 186.01 KiB/s 0s
</span></span><span style="display:flex;"><span>2022-07-02 12:37:07 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>argocd-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:37:07 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: argocd-darwin-arm64_0.7.0.so doesn<span style="color:#f1fa8c">&#39;t match with .md5 and will be downloaded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:37:08 ℹ [INFO]  Downloading: [argocd-darwin-arm64_0.7.0.so] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 78.22 MiB / 78.22 MiB [================================] 100.00% 2.53 MiB/s 30s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:37:39 ✔ [SUCCESS]  [argocd-darwin-arm64_0.7.0.so] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:37:40 ℹ [INFO]  Downloading: [argocd-darwin-arm64_0.7.0.md5] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 33 B / 33 B [=========================================] 100.00% 136.46 KiB/s 0s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:37:40 ✔ [SUCCESS]  [argocd-darwin-arm64_0.7.0.md5] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:37:41 ℹ [INFO]  Downloading: [argocdapp-darwin-arm64_0.7.0.so] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 68.19 MiB / 68.19 MiB [================================] 100.00% 2.41 MiB/s 28s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:38:09 ✔ [SUCCESS]  [argocdapp-darwin-arm64_0.7.0.so] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:38:10 ℹ [INFO]  Downloading: [argocdapp-darwin-arm64_0.7.0.md5] ...
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"> 33 B / 33 B [=========================================] 100.00% 256.96 KiB/s 0s
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:38:10 ✔ [SUCCESS]  [argocdapp-darwin-arm64_0.7.0.md5] download succeeded.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 12:38:10 ℹ [INFO]  Plugin: argocdapp-darwin-arm64_0.7.0.so doesn&#39;</span>t match with .md5 and will be downloaded.
</span></span><span style="display:flex;"><span>2022-07-02 12:38:10 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>argocdapp-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> 68.19 MiB / 68.19 MiB <span style="color:#ff79c6">[================================]</span> 100.00% 1.39 MiB/s 48s
</span></span><span style="display:flex;"><span>2022-07-02 12:38:59 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>argocdapp-darwin-arm64_0.7.0.so<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:01 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Downloading: <span style="color:#ff79c6">[</span>argocdapp-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> ...
</span></span><span style="display:flex;"><span> <span style="color:#bd93f9">33</span> B / <span style="color:#bd93f9">33</span> B <span style="color:#ff79c6">[=========================================]</span> 100.00% 120.98 KiB/s 0s
</span></span><span style="display:flex;"><span>2022-07-02 12:39:01 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  <span style="color:#ff79c6">[</span>argocdapp-darwin-arm64_0.7.0.md5<span style="color:#ff79c6">]</span> download succeeded.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:01 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Initialize finished.
</span></span></code></pre></div><p>当我们再次执行 <code>dtm init</code> 命令的时候可以看到没有任何相关操作，这是因为前面我们已经将相关的插件全部下载到了本地。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm init
</span></span><span style="display:flex;"><span>2022-07-02 12:39:42 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Got Backend from config: <span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>2022-07-02 12:39:42 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Using dir &lt;.devstream&gt; to store plugins.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:42 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: github-repo-scaffolding-golang-darwin-arm64_0.7.0.so already exists, no need to download.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:42 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: githubactions-golang-darwin-arm64_0.7.0.so already exists, no need to download.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:43 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: argocd-darwin-arm64_0.7.0.so already exists, no need to download.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:43 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Plugin: argocdapp-darwin-arm64_0.7.0.so already exists, no need to download.
</span></span><span style="display:flex;"><span>2022-07-02 12:39:43 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Initialize finished.
</span></span></code></pre></div><p>初始化完成后会在当前目录下面创建一个 <code>.devstream</code> 的目录，该目录下面就是保存下载下来的插件相关文件。</p>
<!-- raw HTML omitted -->
<p>接下来我们只需要在根目录下面执行 <code>dtm apply</code> 命令即可根据我们的配置文件创建或更新 DevOps 工具链了。</p>
<p>首先要记得配置需要的环境变量，比如我们这里上面的定义几个插件需要配置下面的 3 个环境变量：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">GITHUB_TOKEN</span><span style="color:#ff79c6">=</span>xxx
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">DOCKERHUB_USERNAME</span><span style="color:#ff79c6">=</span>cnych
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">DOCKERHUB_TOKEN</span><span style="color:#ff79c6">=</span>xxx
</span></span></code></pre></div><p>另外还需要一个在本地可访问的 Kubernetes 集群。</p>
<p>配置完成后直接执行 <code>dtm apply</code> 命令即可：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dtm apply
</span></span><span style="display:flex;"><span>2022-07-02 13:17:15 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Apply started.
</span></span><span style="display:flex;"><span>2022-07-02 13:17:15 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Got Backend from config: <span style="color:#8be9fd;font-style:italic">local</span>
</span></span><span style="display:flex;"><span>2022-07-02 13:17:15 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Using dir &lt;.devstream&gt; to store plugins.
</span></span><span style="display:flex;"><span>2022-07-02 13:17:15 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Using <span style="color:#8be9fd;font-style:italic">local</span> backend. State file: devstream.state.
</span></span><span style="display:flex;"><span>2022-07-02 13:17:17 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Tool <span style="color:#ff79c6">(</span>argocd/default<span style="color:#ff79c6">)</span> found in config but doesn<span style="color:#f1fa8c">&#39;t exist in the state, will be created.
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">2022-07-02 13:17:17 ℹ [INFO]  Tool (argocdapp/default) found in config but doesn&#39;</span>t exist in the state, will be created.
</span></span><span style="display:flex;"><span>Continue? <span style="color:#ff79c6">[</span>y/n<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>Enter a value <span style="color:#ff79c6">(</span>Default is n<span style="color:#ff79c6">)</span>: y
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022-07-02 12:54:38 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Start executing the plan.
</span></span><span style="display:flex;"><span>2022-07-02 12:54:38 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Changes count: 4.
</span></span><span style="display:flex;"><span>2022-07-02 12:54:38 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  -------------------- <span style="color:#ff79c6">[</span>  Processing progress: 1/4.  <span style="color:#ff79c6">]</span> --------------------
</span></span><span style="display:flex;"><span>2022-07-02 12:54:38 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Processing: <span style="color:#ff79c6">(</span>github-repo-scaffolding-golang/default<span style="color:#ff79c6">)</span> -&gt; Create ...
</span></span><span style="display:flex;"><span>2022-07-02 12:54:43 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  The repo dtm-test-go has been created.
</span></span><span style="display:flex;"><span>2022-07-02 12:54:55 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Tool <span style="color:#ff79c6">(</span>github-repo-scaffolding-golang/default<span style="color:#ff79c6">)</span> Create <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>2022-07-02 12:54:55 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  -------------------- <span style="color:#ff79c6">[</span>  Processing progress: 3/4.  <span style="color:#ff79c6">]</span> -
</span></span><span style="display:flex;"><span>2022-07-02 13:17:19 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Processing: <span style="color:#ff79c6">(</span>argocd/default<span style="color:#ff79c6">)</span> -&gt; Create ...
</span></span><span style="display:flex;"><span>2022-07-02 13:17:28 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Creating or updating helm chart ...
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 creating <span style="color:#bd93f9">1</span> resource<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 creating <span style="color:#bd93f9">1</span> resource<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 creating <span style="color:#bd93f9">1</span> resource<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 creating <span style="color:#bd93f9">1</span> resource<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 Clearing discovery cache
</span></span><span style="display:flex;"><span>2022/07/02 13:17:33 beginning <span style="color:#8be9fd;font-style:italic">wait</span> <span style="color:#ff79c6">for</span> <span style="color:#bd93f9">4</span> resources with timeout of 1m0s
</span></span><span style="display:flex;"><span>2022/07/02 13:17:39 creating <span style="color:#bd93f9">43</span> resource<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>2022/07/02 13:17:39 beginning <span style="color:#8be9fd;font-style:italic">wait</span> <span style="color:#ff79c6">for</span> <span style="color:#bd93f9">43</span> resources with timeout of 5m0s
</span></span><span style="display:flex;"><span>2022/07/02 13:17:40 Deployment is not ready: argocd/argocd-applicationset-controller. <span style="color:#bd93f9">0</span> out of <span style="color:#bd93f9">1</span> expected pods are ready
</span></span><span style="display:flex;"><span>2022/07/02 13:17:42 Deployment is not ready: argocd/argocd-applicationset-controller. <span style="color:#bd93f9">0</span> out of <span style="color:#bd93f9">1</span> expected pods are ready
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>2022/07/02 13:19:44 Deployment is not ready: argocd/argocd-applicationset-controller. <span style="color:#bd93f9">0</span> out of <span style="color:#bd93f9">1</span> expected pods are ready
</span></span><span style="display:flex;"><span>2022/07/02 13:38:27 Deployment is not ready: argocd/argocd-dex-server. <span style="color:#bd93f9">0</span> out of <span style="color:#bd93f9">1</span> expected pods are ready
</span></span><span style="display:flex;"><span>2022/07/02 13:38:30 release installed successfully: argocd/argo-cd-4.9.11
</span></span><span style="display:flex;"><span>2022-07-02 13:38:30 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Tool <span style="color:#ff79c6">(</span>argocd/default<span style="color:#ff79c6">)</span> Create <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>2022-07-02 13:38:30 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  -------------------- <span style="color:#ff79c6">[</span>  Processing progress: 4/4.  <span style="color:#ff79c6">]</span> --------------------
</span></span><span style="display:flex;"><span>2022-07-02 13:38:30 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  Processing: <span style="color:#ff79c6">(</span>argocdapp/default<span style="color:#ff79c6">)</span> -&gt; Create ...
</span></span><span style="display:flex;"><span>2022-07-02 13:38:31 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  application.argoproj.io/dtm-test-go created
</span></span><span style="display:flex;"><span>2022-07-02 13:38:31 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Tool <span style="color:#ff79c6">(</span>argocdapp/default<span style="color:#ff79c6">)</span> Create <span style="color:#ff79c6">done</span>.
</span></span><span style="display:flex;"><span>2022-07-02 13:38:31 ℹ <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span>  -------------------- <span style="color:#ff79c6">[</span>  Processing <span style="color:#ff79c6">done</span>.  <span style="color:#ff79c6">]</span> --------------------
</span></span><span style="display:flex;"><span>2022-07-02 13:38:31 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  All plugins applied successfully.
</span></span><span style="display:flex;"><span>2022-07-02 13:38:31 ✔ <span style="color:#ff79c6">[</span>SUCCESS<span style="color:#ff79c6">]</span>  Apply finished.
</span></span></code></pre></div><p>在 <code>apply</code> 的过程中会将执行的状态保存在定义的状态后端存储中，比如我们这里使用的是本地存储，则会在根目录的 <code>devstream.state</code> 文件中保存执行的状态，比如我们这里一共 4 个工具链，如果前两个执行完成，后面两个执行识别了，则会在该文件中保存前两个插件的状态，下一次重新 apply 的时候则只需要执行后面两个工具链即可。</p>
<p><img src="https://picdn.youdianzhishi.com/images/1656740036542.png" alt=""></p>
<p>我们上面定义的工具链最终会为我们在 GitHub 上创建一个 Golang Web 的脚手架应用代码仓库。
<img src="https://picdn.youdianzhishi.com/images/1656740453666.jpg" alt=""></p>
<p>会使用 Github Actions 来进行 CI 操作，构建 Docker 镜像。
<img src="https://picdn.youdianzhishi.com/images/1656740502749.jpg" alt=""></p>
<p>CI 流程最后会推送镜像到 Docker Hub。
<img src="https://picdn.youdianzhishi.com/images/1656740570211.jpg" alt=""></p>
<p>然后会在 Kubernetes 中部署 ArgoCD。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get pods -n argocd
</span></span><span style="display:flex;"><span>NAME                                                READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>argocd-application-controller-0                     1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span><span style="display:flex;"><span>argocd-applicationset-controller-64d8c477f4-2wrg6   1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span><span style="display:flex;"><span>argocd-dex-server-dbdbf5499-krmfz                   1/1     Running   <span style="color:#bd93f9">0</span>          5m35s
</span></span><span style="display:flex;"><span>argocd-notifications-controller-b67c4bdb4-22t9l     1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span><span style="display:flex;"><span>argocd-redis-df9db799b-8gbpv                        1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span><span style="display:flex;"><span>argocd-repo-server-56769cdd47-zs65j                 1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span><span style="display:flex;"><span>argocd-server-7d4745f689-w5pp7                      1/1     Running   <span style="color:#bd93f9">0</span>          5m55s
</span></span></code></pre></div><p>最后会通过 ArgoCD 来进行 CD 操作，将我们的示例应用部署到 Kubernetes 集群中去，其实就是创建了一个 ArgoCD 的 Application 对象。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get applications -n argocd
</span></span><span style="display:flex;"><span>NAME          SYNC STATUS   HEALTH STATUS
</span></span><span style="display:flex;"><span>dtm-test-go   Unknown       Healthy
</span></span></code></pre></div><p>我们也可以通过 ArgoCD 查看部署的应用详情。
<img src="https://picdn.youdianzhishi.com/images/1656741508757.jpg" alt=""></p>
<p>最后如果想要删除整个工具链则只需要执行 <code>dtm delete</code> 命令即可。</p>
<p>整个流程体验非常顺畅（除了因为某些原因访问 GitHub 超级慢之外），我们只需要根据需要在配置文件中定义对应的插件即可，关于插件的具体配置方式可以参考官方文档 <a href="https://docs.devstream.io/en/latest/plugins/plugins-list/">https://docs.devstream.io/en/latest/plugins/plugins-list/</a> 了解更多相关信息。</p>
<p>只需要在一个  <code>YAML</code>  配置文件中定义你所需要的 DevOps 工具，只需按一个命令就能建立起整个 DevOps 工具链和 SDLC 工作流了，所以说 <code>DevStream</code> 是神器完全不为过。</p>
<!-- raw HTML omitted -->

          <h2>微信公众号</h2>
<p>
  扫描下面的二维码关注我们的微信公众帐号，在微信公众帐号中回复◉加群◉即可加入到我们的
  kubernetes 讨论群里面共同学习。
</p>
<img
  src="https://picdn.youdianzhishi.com/images/qrcode.png"
  alt="wechat-account-qrcode"
/>

  
          
            <div class="entry-shang text-center">
    <p>「真诚赞赏，手留余香」</p>
    <button class="zs show-zs btn btn-bred">赞赏</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
    <div class="zs-modal-head">
        <button type="button" class="close">×</button>
        <span class="author"><img src="https://www.qikqiak.com/img/avatar.jpeg"/>阳明</span>
        <p class="tip"><i></i><span>请我喝杯咖啡？</span></p>
    </div>
    <div class="zs-modal-body">
        <div class="zs-modal-btns">
            <button class="btn btn-blink" data-num="2">2元</button>
            <button class="btn btn-blink" data-num="5">5元</button>
            <button class="btn btn-blink" data-num="10">10元</button>
            <button class="btn btn-blink" data-num="50">50元</button>
            <button class="btn btn-blink" data-num="100">100元</button>
            <button class="btn btn-blink" data-num="1">任意金额</button>
        </div>
        <div class="zs-modal-pay">
            <button class="btn btn-bred" id="pay-text">2元</button>
            <p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
            <img src="https://www.qikqiak.com/img/wechat-2.png" id="pay-image"/>
        </div>
    </div>
    <div class="zs-modal-footer">
        <span class="zs-wechat"><img src="https://www.qikqiak.com/img/wechat-btn.png"/></span>
    </div>
</div>
          
          
            <div class="social-share" data-initialized="true" style="margin-bottom: 20px;margin-top:20px;">
    <center>
    <a href="#" class="social-share-icon icon-weibo"></a>
    <a href="#" class="social-share-icon icon-wechat"></a>
    <a href="#" class="social-share-icon icon-twitter"></a>
    <a href="#" class="social-share-icon icon-linkedin"></a>
    <a href="#" class="social-share-icon icon-facebook"></a>
    <a href="#" class="social-share-icon icon-qq"></a>
    <a href="#" class="social-share-icon icon-qzone"></a>
    </center>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

          
        </article>
  
        
          

<h3>相关文章</h3>
<ul style="margin-bottom: 25px;">
    
    <li><a href="https://www.qikqiak.com/post/gitops-devops-on-k8s/">GitOps - 在 Kubernetes 中进行 DevOps 的方式</a></li>
    
    <li><a href="https://www.qikqiak.com/post/visualize-kubernetes-app/">可视化创建 Kubernetes 微服务应用</a></li>
    
    <li><a href="https://www.qikqiak.com/post/devops-base-on-jenkins/">基于 Jenkins 的 DevOps 流水线实践</a></li>
    
    <li><a href="https://www.qikqiak.com/post/drone-with-k8s-3/">Drone 结合 Helm 部署 Kubernetes 应用</a></li>
    
    <li><a href="https://www.qikqiak.com/post/drone-with-k8s-2/">使用 Drone Pipeline 构建 Docker 镜像</a></li>
    
    <li><a href="https://www.qikqiak.com/post/drone-with-k8s-1/">使用 Kubernetes Helm 安装 Drone</a></li>
    
    <li><a href="https://www.qikqiak.com/post/complete-cicd-demonstrate-2/">基于 Jenkins、Gitlab、Harbor、Helm 和 Kubernetes 的 CI/CD(二)</a></li>
    
    <li><a href="https://www.qikqiak.com/post/complete-cicd-demonstrate-1/">基于 Jenkins、Gitlab、Harbor、Helm 和 Kubernetes 的 CI/CD(一)</a></li>
    
    <li><a href="https://www.qikqiak.com/post/gitlab-ci-k8s-cluster-feature/">Gitlab CI 与 Kubernetes 的结合</a></li>
    
    <li><a href="https://www.qikqiak.com/post/gitlab-runner-install-on-k8s/">在 Kubernetes 上安装 Gitlab CI Runner</a></li>
    
</ul>

        
  
        
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://www.qikqiak.com/post/how-to-change-k8s-node-ip/" data-toggle="tooltip" data-placement="top" title="如何修改 Kubernetes 节点 IP 地址?">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="https://www.qikqiak.com/post/how-to-subscribe-chatgpt-plus-try-gpt-4/" data-toggle="tooltip" data-placement="top" title="保姆级教程 | 手把手叫你如何开通 ChatGPT Plus 试用 GPT-4">后一篇 &rarr;</a>
            </li>
          
        </ul>
        

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-5376999672787220"
            data-ad-slot="3700507799"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
  
        
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    var gitalk = new Gitalk({
        clientID: 'bdb76dbb2e9d0786e350',
        clientSecret: 'b454b2a08013fd0e32013be7a63fa8fcb262b6c4',
        repo: 'blog',
        owner: 'cnych',
        admin: ['cnych'],
        labels: ['gitment'],
        title: 'DevOps 工具链管理器 DevStream 还真是神器',
        createIssueManually: true,
        id: 'devops-tools-chain-devstream',      
        distractionFreeMode: true  
    });
    gitalk.render('gitalk-container');
</script>


        
          

        
  
      </div>
    
    
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          <img src="https://www.qikqiak.com/img/wechatmp.png" alt="k8s技术圈">
          
              <li>
                <a href="mailto:icnych@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://github.com/cnych" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://weibo.com/cnych" title="微博">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
              <li>
                <a href="https://instagram.com/cnych" title="Instagram">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          <li>
            <a href="https://www.qikqiak.com/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;
          2023

          
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/">阳明的博客</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/sitemap.xml">网站地图</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/page/archive/">归档</a>
            &nbsp;&bull;&nbsp;
            <a href="https://www.qikqiak.com/page/friend/">友链</a>
            &nbsp;&bull;&nbsp;
            <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备11027319号-5</a>
            <a class="h" href="https://www.qikqiak.com/page/kubernetes.io">kubernetes.io</a>
            <a class="h" href="https://www.qikqiak.com/page/kubernetes.org.cn">Kubernetes中文社区</a>
          
        </p>
        <p class="text-center text-muted">
          <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
          <span id="busuanzi_container_site_pv" style="display:none">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          &nbsp;&bull;&nbsp;
          <span id="busuanzi_container_site_uv" style="display:none">
            访客数<span id="busuanzi_value_site_uv"></span>人次
          </span>
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="http://gohugo.io">Hugo v0.115.4</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/cnych/qikqiak.com">qikqiak-blog</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>


<script src='https://www.qikqiak.com/js/bundle.min.af02a2d23b6651a566f0135a12e65fc2560faa7a969b3d1ad58d0afe0c9164ae.js' integrity='sha256-rwKi0jtmUaVm8BNaEuZfwlYPqnqWmz0a1Y0K/gyRZK4='></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-69668147-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-69668147-3');
</script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script >
$(document).ready(function() {
  var int = setInterval(fixCount, 50);  
  
  var initPVCount = 584976;
  var initUVCount = 153191;
  function fixCount() {                   
    if ($("#busuanzi_container_site_pv").css("display") != "none") {
        $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + initPVCount); 
        clearInterval(int); 
    }
    if ($("#busuanzi_container_site_uv").css("display") != "none") {
      $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + initUVCount);
      clearInterval(int); 
    }  
  }           
});
</script>
 <script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BJICPtxnbz-7vq9kEwH5psPCuHe2CvludQug4R2tuJGPF0GQT2hwSWTAhlSt2EFD5InpuQyxCGJdigf6-KbQ53c');</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery-migrate@1.2.1/dist/jquery-migrate.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript">
$('.carousel').slick({
    dots: true,
    arrows: true,
    autoplay: true,
    autoplaySpeed: 4000,
    infinite: true,
    speed: 500,
    fade: true,
    cssEase: 'linear',
    centerMode: true,
    prevArrow: '<button type="button" class="slick-prev"></button>',
    nextArrow: '<button type="button" class="slick-next"></button>',
});
</script>

  </body>
</html>

